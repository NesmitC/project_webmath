<!-- templates/admin/edit_question.html -->
{% extends "base.html" %}

{% block content %}
<section class="py-12 bg-white">
    <div class="container mx-auto px-6 max-w-2xl">
        <h1 class="text-2xl font-bold mb-6">Редактировать вопрос</h1>

        <form method="POST">
            <div class="mb-4">
                <label class="block font-medium mb-2">Номер вопроса</label>
                <input type="number" name="question_number" value="{{ question.question_number }}"
                    class="border p-2 w-full rounded" required min="1" max="27">
            </div>

            <div class="mb-4">
                <label class="block font-medium mb-2">Тип вопроса</label>
                <select name="question_type" class="border p-2 w-full rounded" id="question-type">
                    <option value="input" {% if question.question_type=='input' %}selected{% endif %}>Ответ текстом
                    </option>
                    <option value="short-answer" {% if question.question_type=='short-answer' %}selected{% endif %}>
                        Краткий ответ (одно поле)</option>
                    <option value="checkbox" {% if question.question_type=='checkbox' %}selected{% endif %}>Выбор
                        нескольких</option>
                    <option value="match" {% if question.question_type=='match' %}selected{% endif %}>Установить
                        соответствие</option>
                    <option value="textarea" {% if question.question_type=='textarea' %}selected{% endif %}>Сочинение
                    </option>
                </select>
            </div>

            <!-- ✅ Поле: Текст задания (общий) -->
            <div id="task-text-field"
                class="mb-4 {% if question.question_type in ['short-answer', 'checkbox', 'match'] %}{% else %}hidden{% endif %}">
                <label class="block font-medium mb-2">Текст задания (общий)</label>
                <textarea name="task_text" class="border p-2 w-full rounded" rows="3"
                    placeholder="Например: В одном из слов допущена ошибка...">{{ question.task_text }}</textarea>
            </div>

            <!-- ✅ Поле: Текст вопроса -->
            <div class="mb-4">
                <label class="block font-medium mb-2">Текст вопроса</label>
                <textarea name="question_text" class="border p-2 w-full rounded" rows="3" required
                    placeholder="Например: опытные КОНСТРУКТОРЫ">{{ question.question_text }}</textarea>
            </div>

            <!-- ✅ Поле: Варианты (для checkbox, match) -->
            <div id="options-field"
                class="mb-4 {% if question.question_type in ['checkbox', 'match'] %}{% else %}hidden{% endif %}">
                <label class="block font-medium mb-2">Варианты (через |)</label>
                <input type="text" name="options" value="{{ question.options or '' }}" class="border p-2 w-full rounded"
                    placeholder="опция1|опция2|...">
            </div>

            <!-- ✅ Правильный ответ -->
            <div class="mb-4">
                <label class="block font-medium mb-2">Правильный ответ</label>
                <input type="text" name="correct_answer" value="{{ question.correct_answer }}"
                    class="border p-2 w-full rounded" required>
            </div>

            <!-- ✅ Доп. инфо (для сочинения) -->
            <div id="info-field" class="mb-4 {% if question.question_type == 'textarea' %}{% else %}hidden{% endif %}">
                <label class="block font-medium mb-2">Доп. информация</label>
                <input type="text" name="info" value="{{ question.info or '' }}" class="border p-2 w-full rounded"
                    placeholder="Ответ должен быть не менее 150 слов">
            </div>

            <div class="flex space-x-4">
                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
                    Сохранить изменения
                </button>
                <a href="{{ url_for('admin.view_test', test_type_name=question.test.test_type.name) }}"
                    class="text-gray-600 hover:underline">
                    Отмена
                </a>
            </div>
        </form>
    </div>
</section>

<script>
    // Показываем/скрываем поля в зависимости от типа вопроса
    document.getElementById('question-type').addEventListener('change', function () {
        const taskTextField = document.getElementById('task-text-field');
        const optionsField = document.getElementById('options-field');
        const infoField = document.getElementById('info-field');
        const type = this.value;

        // Показываем task_text для short-answer, checkbox, match
        if (['short-answer', 'checkbox', 'match'].includes(type)) {
            taskTextField.classList.remove('hidden');
        } else {
            taskTextField.classList.add('hidden');
        }

        // Показываем options для checkbox, match
        if (['checkbox', 'match'].includes(type)) {
            optionsField.classList.remove('hidden');
        } else {
            optionsField.classList.add('hidden');
        }

        // Показываем info для textarea
        if (type === 'textarea') {
            infoField.classList.remove('hidden');
        } else {
            infoField.classList.add('hidden');
        }
    });

    // Запускаем при загрузке, чтобы правильно отобразить текущие поля
    document.addEventListener('DOMContentLoaded', function () {
        const event = new Event('change');
        document.getElementById('question-type').dispatchEvent(event);
    });
</script>
{% endblock %}